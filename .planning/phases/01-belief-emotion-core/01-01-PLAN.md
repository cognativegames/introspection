---
phase: 01-belief-emotion-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - game/0_definitions.rpy
  - game/core/1_game_state.rpy
autonomous: true
requirements:
  - EMOT-01
  - EMOT-02
  - EMOT-03
  - EMOT-04

must_haves:
  truths:
    - "Emotion values are in 0-10 scale"
    - "Self-awareness is calculated as inverse of negative belief intensity"
    - "Self-awareness >= 70% unlocks player-facing UI"
  artifacts:
    - path: "game/0_definitions.rpy"
      provides: "EMOTION_TAXONOMY with 0-10 baselines"
    - path: "game/core/1_game_state.rpy"
      provides: "calculate_self_awareness() and is_self_awareness_unlocked() methods"
  key_links:
    - from: "game/core/1_game_state.rpy"
      to: "game/0_definitions.rpy"
      via: "EMOTION_TAXONOMY baseline import"
---

<objective>
Fix emotion scale from 0-100 to 0-10 and add self-awareness calculation system.
</objective>

<context>
@game/0_definitions.rpy - Contains EMOTION_TAXONOMY with 0-100 baselines
@game/core/1_game_state.rpy - GameState class with emotion methods
@.planning/phases/01-belief-emotion-core/01-CONTEXT.md

**CRITICAL:** CONTEXT specifies 0-10 emotion scale. Current code uses 0-100.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update EMOTION_TAXONOMY baselines to 0-10</name>
  <files>game/0_definitions.rpy</files>
  <action>
    In EMOTION_TAXONOMY dict, change all "baseline" values from 0-100 scale to 0-10 scale:
    - stress: 30 → 3
    - overwhelm: 20 → 2
    - anxiety: 30 → 3
    - fear: 20 → 2
    - vulnerability: 40 → 4
    - loneliness: 30 → 3
    - isolation: 30 → 3
    - shame: 20 → 2
    - inadequacy: 25 → 3 (round)
    - clarity: 50 → 5
    - insight: 40 → 4
    - hope: 50 → 5
    - connection: 40 → 4
    - belonging: 35 → 4 (round)
    - compassion: 40 → 4
    - anger: 20 → 2
    - arousal: 20 → 2

    Keep related_beliefs and definitions unchanged.
  </action>
  <verify>
    Verify all 17 emotion baselines are now 0-10 (grep for "baseline:" in file)
  </verify>
  <done>All EMOTION_TAXONOMY baselines are 0-10</done>
</task>

<task type="auto">
  <name>Task 2: Update adjust_emotions bounds to 0-10</name>
  <files>game/core/1_game_state.rpy</files>
  <action>
    In GameState.adjust_emotions() method, change the bounds from 100 to 10:
    Line ~153: `self.emotions[emotion] = max(0, min(100, self.emotions[emotion] + delta))`
    → Change to: `self.emotions[emotion] = max(0, min(10, self.emotions[emotion] + delta))`

    Also update all threshold comparisons in the file that check against 60, 70, etc.:
    - Line 196: `if self.emotions.get("shame", 0) >= 60:` → `>= 6`
    - Line 201: `if self.emotions.get("loneliness", 0) >= 60:` → `>= 6`
    - Line 206: `if self.emotions.get("anxiety", 0) >= 60:` → `>= 6`
    - Line 211: `if self.emotions.get("clarity", 0) >= 60` → `>= 6`
    - Line 280: `if self.emotions['anxiety'] > 70` → `> 7`
    - Line 280: `if self.emotions['overwhelm'] > 70` → `> 7`
  </action>
  <verify>
    All emotion comparisons use 0-10 scale thresholds
  </verify>
  <done>adjust_emotions enforces 0-10 bounds</done>
</task>

<task type="auto">
  <name>Task 3: Add self-awareness calculation to GameState</name>
  <files>game/core/1_game_state.rpy</files>
  <action>
    Add new method to GameState class after get_emotion_belief_feedback() (~line 214):

    ```
    def calculate_self_awareness(self):
        """
        Calculate self-awareness as inverse of negative belief intensity.
        Fewer/lower negative beliefs = higher self-awareness.
        
        Formula: 100 - (sum of negative belief intensities * multiplier)
        Normalized to 0-100 scale for percentage.
        """
        negative_intensity_sum = 0
        negative_count = 0
        
        for belief_id, intensity in self.beliefs.items():
            if belief_id in beliefs and beliefs[belief_id].get('type') == 'negative':
                if intensity > BELIEF_INTENSITY_DORMANT:  # Only count active beliefs
                    negative_intensity_sum += intensity
                    negative_count += 1
        
        # Max possible negative intensity = 5 (RESOLVED) * number of beliefs
        # Normalize: start at 100, subtract based on negative belief burden
        max_negatives = 15  # Assume 3 core negative beliefs at max intensity
        if negative_count > 0:
            burden = (negative_intensity_sum / max_negatives) * 100
        else:
            burden = 0
        
        self_awareness = max(0, min(100, 100 - burden))
        return self_awareness

    def get_self_awareness_percentage(self):
        """Return self-awareness as 0-100 integer percentage"""
        return int(self.calculate_self_awareness())

    def is_self_awareness_unlocked(self):
        """Check if self-awareness threshold (70%) is reached"""
        return self.calculate_self_awareness() >= 70
    ```

    Also update get_dominant_emotion() to work with 0-10 scale:
    Line ~158: The max comparison still works since it's comparing relative values.
  </action>
  <verify>
    self_awareness_percentage method returns 0-100, is_self_awareness_unlocked() returns bool
  </verify>
  <done>Self-awareness calculation added to GameState</done>
</task>

</tasks>

<verification>
- EMOTION_TAXONOMY has all baselines in 0-10 range
- adjust_emotions() uses max(0, min(10, ...))
- All emotion threshold checks updated (60→6, 70→7, etc.)
- GameState has calculate_self_awareness() and is_self_awareness_unlocked()
</verification>

<success_criteria>
1. All emotions initialized at 0-10 baselines in EMOTION_TAXONOMY
2. adjust_emotions() enforces 0-10 bounds
3. Self-awareness calculation returns 0-100 based on negative belief burden
4. is_self_awareness_unlocked() returns true when >= 70%
</success_criteria>

<output>
After completion, create `.planning/phases/01-belief-emotion-core/01-01-SUMMARY.md`
</output>
